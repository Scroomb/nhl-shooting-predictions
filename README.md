# Predicting Optimal Shooting Locations

### Overview
Modern hockey advanced statistics focus on quantities of shots for a given team.  This can provide some interesting metrics, but there is no way to quantify where each shot is coming from.  A shot that occurs right next to the goal carries the same weight as a shot that occurs at center ice.  Luckily, since 2010, the NHL started tracking in game events on an XY coordinate system.  Using this data for a given season, can optimal shooting locations be predicted?

### Data
The data is accessed through a public API.  Endpoints exist for individual games in a season, player statistics for a given season, player information, and many others.  Each query produces a JSON file that I have stored in a MongoDB.  For this model, I am assuming that the side of the rink does not have any affect on a shot, therefore I have combined all data into the east side of the rink.  Additionally, since the XY coordinates only measure a single one foot by one foot square on the rink, I have generated kernel density estimations for the distribution of shots and goals for both the shooters and goalies.  KDEs are used in place of frequencies to provide a generalization of the observed shots and goals.  Since a one foot by one foot square is small compared to an entire rink, most goals occur in a unique coordinate pair.  By generating likelihood values for every point on the rink, a predicted distribution can be generated.

##### Nathan MacKinnon
![Nathan MacKinnon](/figs/nm_shots.png) ![Nathan MacKinnon](/figs/nm_goals.png)

##### Pekka Rinne
![Pekka Rinne](/figs/pr_shots.png)![Pekka Rinne](/figs/pr_goals.png)

### Model  
A two hidden layer multilevel perceptron with 100 nodes in each level was trained on the distributions for every goal and shot in the 2017-2018 NHL season.  Input features included, X, Y, shooter goal likelihood, and goalie save likelihood.  Additionally, the target variable, goal or not goal, was generated by saying a goal had a value of 1 and a shot had a value of 0.  Hyper-parameters were chosen with cross validation with F1-score used to compare models.  F1-score was used because the model needs to predict where a player should attempt to shoot from.   The model will need to correctly identify a location as a chance for a goal and not miss classify a location.

The goal data is under-represented when compared to shots.  In the 2017-2018 season, shots out weight goals 10 to 1.  To alleviate this imbalance the Synthetic Minority Over-sampling Technique (SMOTE) is used.  Synthetic samples are generated from the minority class using a k-neighbors approach.

### Results
The model is used to generate optimal shooting locations on a per player vs goalie instance.  The model is fed a data set that contains every XY coordinate with the corresponding goal likelihood for the player and save likelihood of the goalie.

Currently, the Colorado Avalanche are playing the Nashville Predators in the first round of the playoffs, so lets look at the model's predicted optimal shooting locations for the Avalanche's starting line-up vs the Predators' starting goalie.

##### Nathan MacKinnon(C) vs Pekka Rinne  
![NM vs PR](/figs/nm_vs_pr.png)
##### Gabriel Landeskog(LW) vs Pekka Rinne
![GL vs PR](/figs/gl_vs_pr.png)
##### Mikko Rantanen(RW) vs Pekka Rinne
![MR vs PR](/figs/mr_vs_pr.png)
##### Tyson Barrie(D) vs Pekka Rinne
![TB vs PR](/figs/tb_vs_pr.png)
##### Nikita Zadorov(D) vs Pekka Rinne
![NZ vs PR](/figs/nz_vs_pr.png)

A couple of interesting points can be seen in these plots.  Since the majority of goals are scored right in front of the net, it makes sense that, players should attempt to take their shots at that location.  Also, the model is able to see position of players.  Gabriel Landeskog plays mainly Left Wing and is known for being able to fight through defenses and score from in close, and the model is recommending he continue to do so.  Tyson Barrie, on the other hand, plays defense and is known for scoring from the blue line.  This is also reflected in the model.

Lets also look at the Predators' starting lineup vs the Avalanche's starting goalie.
##### Filip Forsberg(LW) vs Jonathan Bernier
![FF vs JB](/figs/ff_vs_jb.png)
##### Ryan Johansen(C) vs Jonathan Bernier
![RJ vs JB](/figs/rj_vs_jb.png)
##### Viktor Arvidsson vs Jonathan Bernier
![VA vs JB](/figs/va_vs_jb.png)
##### Roman Josi(D) vs Jonathan Bernier
![Josi vs JB](/figs/josi_vs_jb.png)
##### Ryan Ellis(D) vs Jonathan Bernier
![RE vs JB](/figs/re_vs_jb.png)

This model can be used to set defensive strategy as well.  Against Jonathan Bernier, the Nashville defense should focus on shooting from their left side.  This could inform the Avalanche defenders to attempt to prevent the puck from getting to that area, or to focus on blocking shots from that area.

### Future Considerations
 * Enter two teams, Generate a 'game plan'
 - Generate Line Combinations
 - Use Shots, Missed Shots, Blocked Shots, Goals, Saves
 - Use 5v5 vs PP
 - Use Period
 - Use Goal Differential
 - Home vs Away
